#!/bin/sh

SCRIPT_DIR="$( cd "$( dirname "$0" )" && pwd )"
KONG_DIR="$(echo $SCRIPT_DIR | sed -e 's/\/[^\/]*$//')"
KONG_CONF=$KONG_DIR/nginx/kong.conf

function show_help {
  echo $"Usage: $0 {start|stop|restart}"
  exit 1
}

function start {
  echo "Starting Kong"
  sed -i.bak -e "s@{{KONG_CONF}}@$KONG_CONF@g" $KONG_DIR/nginx/nginx.conf
  if [ $? -eq 0 ]; then
    rm $KONG_DIR/nginx/nginx.conf.bak
  fi
  nginx -p $KONG_DIR/nginx -c $KONG_DIR/nginx/nginx.conf
}

function stop {
  echo "Stopping Kong"
  kill $(cat /var/run/nginx.pid)
}

function restart {
  stop
  start
}

# A POSIX variable
OPTIND=1 # Reset in case getopts has been used previously in the shell.

# Initialize our own variables:
cmd=""
verbose=0

while getopts "h?v:" opt; do
    case "$opt" in
    h|\?)
        show_help
        exit 0
        ;;
    v)  version=1
        ;;
    esac
done

shift $((OPTIND-1))

[ "$1" = "--" ] && shift

if [ $version ]; then
  echo "Kong Version 0.1"
  exit 0;
fi

case "$@" in
  start)
      start
      ;;

  stop)
      stop
      ;;

  restart)
      restart
      ;;

  *)
      show_help

esac

# End of file